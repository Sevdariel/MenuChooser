<div class="flex justify-center pt-4">
  <div class="w-1/2 rounded-lg shadow p-4 space-y-5">
    <div class="flex flex-col space-y-4">
      <h1 class="text-2xl font-bold leading-tight">Add new recipe</h1>
    </div>
    <div>
      <form (submit)="saveRecipe($event)">
        <div class="space-y-4 flex flex-col">
          <div class="flex flex-row justify-between space-x-5">
            <p-floatlabel variant="on" class="w-full">
              <input
                id="name"
                type="text"
                class="w-full"
                pInputText
                [formField]="signalForm.name"
              />
              <label for="name">Name</label>
            </p-floatlabel>
            <p-floatlabel variant="on" class="w-full">
              <input
                id="duration"
                type="number"
                class="w-full"
                pInputNumber
                [formField]="signalForm.duration"
              />
              <label for="duration">Duration</label>
            </p-floatlabel>
          </div>

          <p-table
            tableStyleClass="table-fixed"
            size="small"
            [value]="this.recipeModel().products"
          >
            <ng-template #caption>
              <div class="flex flex-row justify-between">
                <span class="text-xl font-bold">Products</span>
                <p-button
                  icon="pi pi-plus"
                  label="Add product"
                  size="small"
                  (click)="openRecipeProductPreview(null)"
                ></p-button>
              </div>
            </ng-template>
            @if (this.recipeModel().products.length > 0) {
              <ng-template #header>
                <tr>
                  @for (column of productColumns; track column) {
                    <th class="flex-grow">{{ column.caption }}</th>
                  }
                  <th class="w-12"></th>
                </tr>
              </ng-template>
              <ng-template #body let-product let-rowIndex="rowIndex">
                <tr class="min-h-10">
                  @for (column of productColumns; track column) {
                    <td class="flex-grow">
                      {{ displayValue(product, column.field) }}
                    </td>
                  }
                  <td class="w-12 flex-shrink-0">
                    <p-button
                      type="button"
                      icon="pi pi-pencil"
                      variant="text"
                      (click)="openRecipeProductPreview(product)"
                    ></p-button>
                  </td>
                </tr>
              </ng-template>
            }
          </p-table>

          <p-table
            tableStyleClass="table-fixed"
            size="small"
            [value]="this.recipeModel().steps"
          >
            <ng-template #caption>
              <div class="flex flex-row justify-between">
                <span class="text-xl font-bold">Steps</span>
                <p-button
                  icon="pi pi-plus"
                  label="Add step"
                  size="small"
                  (click)="openStepPreview(null)"
                ></p-button>
              </div>
            </ng-template>
            @if (this.recipeModel().steps.length > 0) {
              <ng-template #header>
                <tr>
                  @for (column of stepColumns; track column) {
                    <th class="flex-grow">{{ column.caption }}</th>
                  }
                  <th class="w-12"></th>
                </tr>
              </ng-template>
              <ng-template #body let-step let-rowIndex="rowIndex">
                <tr class="min-h-10">
                  @for (column of stepColumns; track column) {
                    <td class="flex-grow">
                      {{ displayValue(step, column.field) }}
                    </td>
                  }
                  <td class="w-12 flex-shrink-0">
                    <p-button
                      type="button"
                      icon="pi pi-pencil"
                      variant="text"
                      (click)="openStepPreview(step)"
                    ></p-button>
                  </td>
                </tr>
              </ng-template>
            }
          </p-table>

          <div class="flex items-end">
            <p-button id="save" type="submit">Save</p-button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<p-drawer
  [header]="drawerHeader()"
  [(visible)]="drawerService.drawerVisible"
  position="right"
  dismissible="true"
  styleClass="md:!w-80 lg:!w-[30rem]"
>
  @if (drawerService.contentVisible() === drawerContent.RecipeProduct) {
    <mc-recipe-product
      [(product)]="selectedProduct"
      (closeDrawer)="onRecipeProductSave($event)"
    ></mc-recipe-product>
  }
  @if (drawerService.contentVisible() === drawerContent.Step) {
    <mc-step
      [(step)]="selectedStep"
      [availableProducts]="recipeModel().products"
      (closeDrawer)="onStepSave($event)"
    ></mc-step>
  }
</p-drawer>
